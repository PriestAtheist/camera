{"ast":null,"code":"import _regeneratorRuntime from\"E:/github/camera/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"E:/github/camera/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"E:/github/camera/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _toConsumableArray from\"E:/github/camera/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"E:/github/camera/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useRef,useCallback}from'react';import freeice from'freeice';import useStateWithCallback from'./useStateWithCallback';import socket from'../socket';import ACTIONS from'../socket/actions';export var LOCAL_VIDEO='LOCAL_VIDEO';export default function useWebRTC(roomID){var _useStateWithCallback=useStateWithCallback([]),_useStateWithCallback2=_slicedToArray(_useStateWithCallback,2),clients=_useStateWithCallback2[0],updateClients=_useStateWithCallback2[1];var addNewClient=useCallback(function(newClient,cb){updateClients(function(list){if(!list.includes(newClient)){return[].concat(_toConsumableArray(list),[newClient]);}return list;},cb);},[clients,updateClients]);var peerConnections=useRef({});var localMediaStream=useRef(null);var peerMediaElements=useRef(_defineProperty({},LOCAL_VIDEO,null));useEffect(function(){function handleNewPeer(_x){return _handleNewPeer.apply(this,arguments);}function _handleNewPeer(){_handleNewPeer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref){var peerID,createOffer,tracksNumber,offer;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:peerID=_ref.peerID,createOffer=_ref.createOffer;if(!(peerID in peerConnections.current)){_context.next=3;break;}return _context.abrupt(\"return\",console.warn(\"Already connected to peer \".concat(peerID)));case 3:peerConnections.current[peerID]=new RTCPeerConnection({iceServers:freeice()});peerConnections.current[peerID].onicecandidate=function(event){if(event.candidate){socket.emit(ACTIONS.RELAY_ICE,{peerID:peerID,iceCandidate:event.candidate});}};tracksNumber=0;peerConnections.current[peerID].ontrack=function(_ref2){var _ref2$streams=_slicedToArray(_ref2.streams,1),remoteStream=_ref2$streams[0];tracksNumber++;if(tracksNumber===2){// video & audio tracks received\ntracksNumber=0;addNewClient(peerID,function(){if(peerMediaElements.current[peerID]){peerMediaElements.current[peerID].srcObject=remoteStream;}else{// FIX LONG RENDER IN CASE OF MANY CLIENTS\nvar settled=false;var interval=setInterval(function(){if(peerMediaElements.current[peerID]){peerMediaElements.current[peerID].srcObject=remoteStream;settled=true;}if(settled){clearInterval(interval);}},1000);}});}};localMediaStream.current.getTracks().forEach(function(track){peerConnections.current[peerID].addTrack(track,localMediaStream.current);});if(!createOffer){_context.next=15;break;}_context.next=11;return peerConnections.current[peerID].createOffer();case 11:offer=_context.sent;_context.next=14;return peerConnections.current[peerID].setLocalDescription(offer);case 14:socket.emit(ACTIONS.RELAY_SDP,{peerID:peerID,sessionDescription:offer});case 15:case\"end\":return _context.stop();}},_callee);}));return _handleNewPeer.apply(this,arguments);}socket.on(ACTIONS.ADD_PEER,handleNewPeer);return function(){socket.off(ACTIONS.ADD_PEER);};},[]);useEffect(function(){function setRemoteMedia(_x2){return _setRemoteMedia.apply(this,arguments);}function _setRemoteMedia(){_setRemoteMedia=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref3){var _peerConnections$curr;var peerID,remoteDescription,answer;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:peerID=_ref3.peerID,remoteDescription=_ref3.sessionDescription;_context2.next=3;return(_peerConnections$curr=peerConnections.current[peerID])===null||_peerConnections$curr===void 0?void 0:_peerConnections$curr.setRemoteDescription(new RTCSessionDescription(remoteDescription));case 3:if(!(remoteDescription.type==='offer')){_context2.next=10;break;}_context2.next=6;return peerConnections.current[peerID].createAnswer();case 6:answer=_context2.sent;_context2.next=9;return peerConnections.current[peerID].setLocalDescription(answer);case 9:socket.emit(ACTIONS.RELAY_SDP,{peerID:peerID,sessionDescription:answer});case 10:case\"end\":return _context2.stop();}},_callee2);}));return _setRemoteMedia.apply(this,arguments);}socket.on(ACTIONS.SESSION_DESCRIPTION,setRemoteMedia);return function(){socket.off(ACTIONS.SESSION_DESCRIPTION);};},[]);useEffect(function(){socket.on(ACTIONS.ICE_CANDIDATE,function(_ref4){var _peerConnections$curr2;var peerID=_ref4.peerID,iceCandidate=_ref4.iceCandidate;(_peerConnections$curr2=peerConnections.current[peerID])===null||_peerConnections$curr2===void 0?void 0:_peerConnections$curr2.addIceCandidate(new RTCIceCandidate(iceCandidate));});return function(){socket.off(ACTIONS.ICE_CANDIDATE);};},[]);useEffect(function(){var handleRemovePeer=function handleRemovePeer(_ref5){var peerID=_ref5.peerID;if(peerConnections.current[peerID]){peerConnections.current[peerID].close();}delete peerConnections.current[peerID];delete peerMediaElements.current[peerID];updateClients(function(list){return list.filter(function(c){return c!==peerID;});});};socket.on(ACTIONS.REMOVE_PEER,handleRemovePeer);return function(){socket.off(ACTIONS.REMOVE_PEER);};},[]);useEffect(function(){function startCapture(){return _startCapture.apply(this,arguments);}function _startCapture(){_startCapture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return navigator.mediaDevices.getUserMedia({audio:true,video:{width:1280,height:720}});case 2:localMediaStream.current=_context3.sent;addNewClient(LOCAL_VIDEO,function(){var localVideoElement=peerMediaElements.current[LOCAL_VIDEO];if(localVideoElement){localVideoElement.volume=0;localVideoElement.srcObject=localMediaStream.current;}});case 4:case\"end\":return _context3.stop();}},_callee3);}));return _startCapture.apply(this,arguments);}startCapture().then(function(){return socket.emit(ACTIONS.JOIN,{room:roomID});}).catch(function(e){return console.error('Error getting userMedia:',e);});{/*return () => {\r\n      localMediaStream.current.getTracks().forEach(track => track.stop());\r\n\r\n      socket.emit(ACTIONS.LEAVE);\r\n    };*/}},[roomID]);var provideMediaRef=useCallback(function(id,node){peerMediaElements.current[id]=node;},[]);return{clients:clients,provideMediaRef:provideMediaRef};}","map":{"version":3,"names":["useEffect","useRef","useCallback","freeice","useStateWithCallback","socket","ACTIONS","LOCAL_VIDEO","useWebRTC","roomID","_useStateWithCallback","_useStateWithCallback2","_slicedToArray","clients","updateClients","addNewClient","newClient","cb","list","includes","concat","_toConsumableArray","peerConnections","localMediaStream","peerMediaElements","_defineProperty","handleNewPeer","_x","_handleNewPeer","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","peerID","createOffer","tracksNumber","offer","wrap","_callee$","_context","prev","next","current","abrupt","console","warn","RTCPeerConnection","iceServers","onicecandidate","event","candidate","emit","RELAY_ICE","iceCandidate","ontrack","_ref2","_ref2$streams","streams","remoteStream","srcObject","settled","interval","setInterval","clearInterval","getTracks","forEach","track","addTrack","sent","setLocalDescription","RELAY_SDP","sessionDescription","stop","on","ADD_PEER","off","setRemoteMedia","_x2","_setRemoteMedia","_callee2","_ref3","_peerConnections$curr","remoteDescription","answer","_callee2$","_context2","setRemoteDescription","RTCSessionDescription","type","createAnswer","SESSION_DESCRIPTION","ICE_CANDIDATE","_ref4","_peerConnections$curr2","addIceCandidate","RTCIceCandidate","handleRemovePeer","_ref5","close","filter","c","REMOVE_PEER","startCapture","_startCapture","_callee3","_callee3$","_context3","navigator","mediaDevices","getUserMedia","audio","video","width","height","localVideoElement","volume","then","JOIN","room","catch","e","error","provideMediaRef","id","node"],"sources":["E:/github/camera/src/hooks/useWebRTC.js"],"sourcesContent":["import {useEffect, useRef, useCallback} from 'react';\r\nimport freeice from 'freeice';\r\nimport useStateWithCallback from './useStateWithCallback';\r\nimport socket from '../socket';\r\nimport ACTIONS from '../socket/actions';\r\n\r\nexport const LOCAL_VIDEO = 'LOCAL_VIDEO';\r\n\r\n\r\nexport default function useWebRTC(roomID) {\r\n  const [clients, updateClients] = useStateWithCallback([]);\r\n\r\n  const addNewClient = useCallback((newClient, cb) => {\r\n    updateClients(list => {\r\n      if (!list.includes(newClient)) {\r\n        return [...list, newClient]\r\n      }\r\n\r\n      return list;\r\n    }, cb);\r\n  }, [clients, updateClients]);\r\n\r\n  const peerConnections = useRef({});\r\n  const localMediaStream = useRef(null);\r\n  const peerMediaElements = useRef({\r\n    [LOCAL_VIDEO]: null,\r\n  });\r\n\r\n  useEffect(() => {\r\n    async function handleNewPeer({peerID, createOffer}) {\r\n      if (peerID in peerConnections.current) {\r\n        return console.warn(`Already connected to peer ${peerID}`);\r\n      }\r\n\r\n      peerConnections.current[peerID] = new RTCPeerConnection({\r\n        iceServers: freeice(),\r\n      });\r\n\r\n      peerConnections.current[peerID].onicecandidate = event => {\r\n        if (event.candidate) {\r\n          socket.emit(ACTIONS.RELAY_ICE, {\r\n            peerID,\r\n            iceCandidate: event.candidate,\r\n          });\r\n        }\r\n      }\r\n\r\n      let tracksNumber = 0;\r\n      peerConnections.current[peerID].ontrack = ({streams: [remoteStream]}) => {\r\n        tracksNumber++\r\n\r\n        if (tracksNumber === 2) { // video & audio tracks received\r\n          tracksNumber = 0;\r\n          addNewClient(peerID, () => {\r\n            if (peerMediaElements.current[peerID]) {\r\n              peerMediaElements.current[peerID].srcObject = remoteStream;\r\n            } else {\r\n              // FIX LONG RENDER IN CASE OF MANY CLIENTS\r\n              let settled = false;\r\n              const interval = setInterval(() => {\r\n                if (peerMediaElements.current[peerID]) {\r\n                  peerMediaElements.current[peerID].srcObject = remoteStream;\r\n                  settled = true;\r\n                }\r\n\r\n                if (settled) {\r\n                  clearInterval(interval);\r\n                }\r\n              }, 1000);\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      localMediaStream.current.getTracks().forEach(track => {\r\n        peerConnections.current[peerID].addTrack(track, localMediaStream.current);\r\n      });\r\n\r\n      if (createOffer) {\r\n        const offer = await peerConnections.current[peerID].createOffer();\r\n\r\n        await peerConnections.current[peerID].setLocalDescription(offer);\r\n\r\n        socket.emit(ACTIONS.RELAY_SDP, {\r\n          peerID,\r\n          sessionDescription: offer,\r\n        });\r\n      }\r\n    }\r\n\r\n    socket.on(ACTIONS.ADD_PEER, handleNewPeer);\r\n\r\n    return () => {\r\n      socket.off(ACTIONS.ADD_PEER);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    async function setRemoteMedia({peerID, sessionDescription: remoteDescription}) {\r\n      await peerConnections.current[peerID]?.setRemoteDescription(\r\n        new RTCSessionDescription(remoteDescription)\r\n      );\r\n\r\n      if (remoteDescription.type === 'offer') {\r\n        const answer = await peerConnections.current[peerID].createAnswer();\r\n\r\n        await peerConnections.current[peerID].setLocalDescription(answer);\r\n\r\n        socket.emit(ACTIONS.RELAY_SDP, {\r\n          peerID,\r\n          sessionDescription: answer,\r\n        });\r\n      }\r\n    }\r\n\r\n    socket.on(ACTIONS.SESSION_DESCRIPTION, setRemoteMedia)\r\n\r\n    return () => {\r\n      socket.off(ACTIONS.SESSION_DESCRIPTION);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    socket.on(ACTIONS.ICE_CANDIDATE, ({peerID, iceCandidate}) => {\r\n      peerConnections.current[peerID]?.addIceCandidate(\r\n        new RTCIceCandidate(iceCandidate)\r\n      );\r\n    });\r\n\r\n    return () => {\r\n      socket.off(ACTIONS.ICE_CANDIDATE);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleRemovePeer = ({peerID}) => {\r\n      if (peerConnections.current[peerID]) {\r\n        peerConnections.current[peerID].close();\r\n      }\r\n\r\n      delete peerConnections.current[peerID];\r\n      delete peerMediaElements.current[peerID];\r\n\r\n      updateClients(list => list.filter(c => c !== peerID));\r\n    };\r\n\r\n    socket.on(ACTIONS.REMOVE_PEER, handleRemovePeer);\r\n\r\n    return () => {\r\n      socket.off(ACTIONS.REMOVE_PEER);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    async function startCapture() {\r\n      localMediaStream.current = await navigator.mediaDevices.getUserMedia({\r\n        audio: true,\r\n        video: {\r\n          width: 1280,\r\n          height: 720,\r\n        }\r\n      });\r\n\r\n      addNewClient(LOCAL_VIDEO, () => {\r\n        const localVideoElement = peerMediaElements.current[LOCAL_VIDEO];\r\n\r\n        if (localVideoElement) {\r\n          localVideoElement.volume = 0;\r\n          localVideoElement.srcObject = localMediaStream.current;\r\n        }\r\n      });\r\n    }\r\n\r\n    startCapture()\r\n      .then(() => socket.emit(ACTIONS.JOIN, {room: roomID}))\r\n      .catch(e => console.error('Error getting userMedia:', e));\r\n\r\n    {/*return () => {\r\n      localMediaStream.current.getTracks().forEach(track => track.stop());\r\n\r\n      socket.emit(ACTIONS.LEAVE);\r\n    };*/}\r\n  }, [roomID]);\r\n\r\n  const provideMediaRef = useCallback((id, node) => {\r\n    peerMediaElements.current[id] = node;\r\n  }, []);\r\n\r\n  return {\r\n    clients,\r\n    provideMediaRef\r\n  };\r\n}"],"mappings":"whBAAA,OAAQA,SAAS,CAAEC,MAAM,CAAEC,WAAW,KAAO,OAAO,CACpD,MAAO,CAAAC,OAAO,KAAM,SAAS,CAC7B,MAAO,CAAAC,oBAAoB,KAAM,wBAAwB,CACzD,MAAO,CAAAC,MAAM,KAAM,WAAW,CAC9B,MAAO,CAAAC,OAAO,KAAM,mBAAmB,CAEvC,MAAO,IAAM,CAAAC,WAAW,CAAG,aAAa,CAGxC,cAAe,SAAS,CAAAC,SAASA,CAACC,MAAM,CAAE,CACxC,IAAAC,qBAAA,CAAiCN,oBAAoB,CAAC,EAAE,CAAC,CAAAO,sBAAA,CAAAC,cAAA,CAAAF,qBAAA,IAAlDG,OAAO,CAAAF,sBAAA,IAAEG,aAAa,CAAAH,sBAAA,IAE7B,GAAM,CAAAI,YAAY,CAAGb,WAAW,CAAC,SAACc,SAAS,CAAEC,EAAE,CAAK,CAClDH,aAAa,CAAC,SAAAI,IAAI,CAAI,CACpB,GAAI,CAACA,IAAI,CAACC,QAAQ,CAACH,SAAS,CAAC,CAAE,CAC7B,SAAAI,MAAA,CAAAC,kBAAA,CAAWH,IAAI,GAAEF,SAAS,GAC5B,CAEA,MAAO,CAAAE,IAAI,CACb,CAAC,CAAED,EAAE,CAAC,CACR,CAAC,CAAE,CAACJ,OAAO,CAAEC,aAAa,CAAC,CAAC,CAE5B,GAAM,CAAAQ,eAAe,CAAGrB,MAAM,CAAC,CAAC,CAAC,CAAC,CAClC,GAAM,CAAAsB,gBAAgB,CAAGtB,MAAM,CAAC,IAAI,CAAC,CACrC,GAAM,CAAAuB,iBAAiB,CAAGvB,MAAM,CAAAwB,eAAA,IAC7BlB,WAAW,CAAG,IAAI,CACpB,CAAC,CAEFP,SAAS,CAAC,UAAM,SACC,CAAA0B,aAAaA,CAAAC,EAAA,SAAAC,cAAA,CAAAC,KAAA,MAAAC,SAAA,YAAAF,eAAA,EAAAA,cAAA,CAAAG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAA5B,SAAAC,QAAAC,IAAA,MAAAC,MAAA,CAAAC,WAAA,CAAAC,YAAA,CAAAC,KAAA,QAAAP,mBAAA,GAAAQ,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAA8BR,MAAM,CAAAD,IAAA,CAANC,MAAM,CAAEC,WAAW,CAAAF,IAAA,CAAXE,WAAW,MAC3CD,MAAM,GAAI,CAAAd,eAAe,CAACuB,OAAO,GAAAH,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAI,MAAA,UAC5BC,OAAO,CAACC,IAAI,8BAAA5B,MAAA,CAA8BgB,MAAM,CAAE,CAAC,SAG5Dd,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAAG,GAAI,CAAAa,iBAAiB,CAAC,CACtDC,UAAU,CAAE/C,OAAO,CAAC,CACtB,CAAC,CAAC,CAEFmB,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACe,cAAc,CAAG,SAAAC,KAAK,CAAI,CACxD,GAAIA,KAAK,CAACC,SAAS,CAAE,CACnBhD,MAAM,CAACiD,IAAI,CAAChD,OAAO,CAACiD,SAAS,CAAE,CAC7BnB,MAAM,CAANA,MAAM,CACNoB,YAAY,CAAEJ,KAAK,CAACC,SACtB,CAAC,CAAC,CACJ,CACF,CAAC,CAEGf,YAAY,CAAG,CAAC,CACpBhB,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACqB,OAAO,CAAG,SAAAC,KAAA,CAA+B,KAAAC,aAAA,CAAA/C,cAAA,CAAA8C,KAAA,CAA7BE,OAAO,IAAGC,YAAY,CAAAF,aAAA,IAChErB,YAAY,EAAE,CAEd,GAAIA,YAAY,GAAK,CAAC,CAAE,CAAE;AACxBA,YAAY,CAAG,CAAC,CAChBvB,YAAY,CAACqB,MAAM,CAAE,UAAM,CACzB,GAAIZ,iBAAiB,CAACqB,OAAO,CAACT,MAAM,CAAC,CAAE,CACrCZ,iBAAiB,CAACqB,OAAO,CAACT,MAAM,CAAC,CAAC0B,SAAS,CAAGD,YAAY,CAC5D,CAAC,IAAM,CACL;AACA,GAAI,CAAAE,OAAO,CAAG,KAAK,CACnB,GAAM,CAAAC,QAAQ,CAAGC,WAAW,CAAC,UAAM,CACjC,GAAIzC,iBAAiB,CAACqB,OAAO,CAACT,MAAM,CAAC,CAAE,CACrCZ,iBAAiB,CAACqB,OAAO,CAACT,MAAM,CAAC,CAAC0B,SAAS,CAAGD,YAAY,CAC1DE,OAAO,CAAG,IAAI,CAChB,CAEA,GAAIA,OAAO,CAAE,CACXG,aAAa,CAACF,QAAQ,CAAC,CACzB,CACF,CAAC,CAAE,IAAI,CAAC,CACV,CACF,CAAC,CAAC,CACJ,CACF,CAAC,CAEDzC,gBAAgB,CAACsB,OAAO,CAACsB,SAAS,CAAC,CAAC,CAACC,OAAO,CAAC,SAAAC,KAAK,CAAI,CACpD/C,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACkC,QAAQ,CAACD,KAAK,CAAE9C,gBAAgB,CAACsB,OAAO,CAAC,CAC3E,CAAC,CAAC,CAAC,IAECR,WAAW,EAAAK,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,UACO,CAAAtB,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACC,WAAW,CAAC,CAAC,SAA3DE,KAAK,CAAAG,QAAA,CAAA6B,IAAA,CAAA7B,QAAA,CAAAE,IAAA,UAEL,CAAAtB,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACoC,mBAAmB,CAACjC,KAAK,CAAC,SAEhElC,MAAM,CAACiD,IAAI,CAAChD,OAAO,CAACmE,SAAS,CAAE,CAC7BrC,MAAM,CAANA,MAAM,CACNsC,kBAAkB,CAAEnC,KACtB,CAAC,CAAC,CAAC,yBAAAG,QAAA,CAAAiC,IAAA,MAAAzC,OAAA,GAEN,UAAAN,cAAA,CAAAC,KAAA,MAAAC,SAAA,GAEDzB,MAAM,CAACuE,EAAE,CAACtE,OAAO,CAACuE,QAAQ,CAAEnD,aAAa,CAAC,CAE1C,MAAO,WAAM,CACXrB,MAAM,CAACyE,GAAG,CAACxE,OAAO,CAACuE,QAAQ,CAAC,CAC9B,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN7E,SAAS,CAAC,UAAM,SACC,CAAA+E,cAAcA,CAAAC,GAAA,SAAAC,eAAA,CAAApD,KAAA,MAAAC,SAAA,YAAAmD,gBAAA,EAAAA,eAAA,CAAAlD,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAA7B,SAAAiD,SAAAC,KAAA,MAAAC,qBAAA,KAAAhD,MAAA,CAAAiD,iBAAA,CAAAC,MAAA,QAAAtD,mBAAA,GAAAQ,IAAA,UAAA+C,UAAAC,SAAA,iBAAAA,SAAA,CAAA7C,IAAA,CAAA6C,SAAA,CAAA5C,IAAA,SAA+BR,MAAM,CAAA+C,KAAA,CAAN/C,MAAM,CAAsBiD,iBAAiB,CAAAF,KAAA,CAArCT,kBAAkB,CAAAc,SAAA,CAAA5C,IAAA,UAAAwC,qBAAA,CACjD9D,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,UAAAgD,qBAAA,iBAA/BA,qBAAA,CAAiCK,oBAAoB,CACzD,GAAI,CAAAC,qBAAqB,CAACL,iBAAiB,CAC7C,CAAC,aAEGA,iBAAiB,CAACM,IAAI,GAAK,OAAO,GAAAH,SAAA,CAAA5C,IAAA,WAAA4C,SAAA,CAAA5C,IAAA,SACf,CAAAtB,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACwD,YAAY,CAAC,CAAC,QAA7DN,MAAM,CAAAE,SAAA,CAAAjB,IAAA,CAAAiB,SAAA,CAAA5C,IAAA,SAEN,CAAAtB,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACoC,mBAAmB,CAACc,MAAM,CAAC,QAEjEjF,MAAM,CAACiD,IAAI,CAAChD,OAAO,CAACmE,SAAS,CAAE,CAC7BrC,MAAM,CAANA,MAAM,CACNsC,kBAAkB,CAAEY,MACtB,CAAC,CAAC,CAAC,yBAAAE,SAAA,CAAAb,IAAA,MAAAO,QAAA,GAEN,UAAAD,eAAA,CAAApD,KAAA,MAAAC,SAAA,GAEDzB,MAAM,CAACuE,EAAE,CAACtE,OAAO,CAACuF,mBAAmB,CAAEd,cAAc,CAAC,CAEtD,MAAO,WAAM,CACX1E,MAAM,CAACyE,GAAG,CAACxE,OAAO,CAACuF,mBAAmB,CAAC,CACzC,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN7F,SAAS,CAAC,UAAM,CACdK,MAAM,CAACuE,EAAE,CAACtE,OAAO,CAACwF,aAAa,CAAE,SAAAC,KAAA,CAA4B,KAAAC,sBAAA,IAA1B,CAAA5D,MAAM,CAAA2D,KAAA,CAAN3D,MAAM,CAAEoB,YAAY,CAAAuC,KAAA,CAAZvC,YAAY,CACrD,CAAAwC,sBAAA,CAAA1E,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,UAAA4D,sBAAA,iBAA/BA,sBAAA,CAAiCC,eAAe,CAC9C,GAAI,CAAAC,eAAe,CAAC1C,YAAY,CAClC,CAAC,CACH,CAAC,CAAC,CAEF,MAAO,WAAM,CACXnD,MAAM,CAACyE,GAAG,CAACxE,OAAO,CAACwF,aAAa,CAAC,CACnC,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN9F,SAAS,CAAC,UAAM,CACd,GAAM,CAAAmG,gBAAgB,CAAG,QAAnB,CAAAA,gBAAgBA,CAAAC,KAAA,CAAiB,IAAZ,CAAAhE,MAAM,CAAAgE,KAAA,CAANhE,MAAM,CAC/B,GAAId,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAAE,CACnCd,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CAACiE,KAAK,CAAC,CAAC,CACzC,CAEA,MAAO,CAAA/E,eAAe,CAACuB,OAAO,CAACT,MAAM,CAAC,CACtC,MAAO,CAAAZ,iBAAiB,CAACqB,OAAO,CAACT,MAAM,CAAC,CAExCtB,aAAa,CAAC,SAAAI,IAAI,QAAI,CAAAA,IAAI,CAACoF,MAAM,CAAC,SAAAC,CAAC,QAAI,CAAAA,CAAC,GAAKnE,MAAM,GAAC,GAAC,CACvD,CAAC,CAED/B,MAAM,CAACuE,EAAE,CAACtE,OAAO,CAACkG,WAAW,CAAEL,gBAAgB,CAAC,CAEhD,MAAO,WAAM,CACX9F,MAAM,CAACyE,GAAG,CAACxE,OAAO,CAACkG,WAAW,CAAC,CACjC,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAENxG,SAAS,CAAC,UAAM,SACC,CAAAyG,YAAYA,CAAA,SAAAC,aAAA,CAAA7E,KAAA,MAAAC,SAAA,YAAA4E,cAAA,EAAAA,aAAA,CAAA3E,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAA3B,SAAA0E,SAAA,SAAA3E,mBAAA,GAAAQ,IAAA,UAAAoE,UAAAC,SAAA,iBAAAA,SAAA,CAAAlE,IAAA,CAAAkE,SAAA,CAAAjE,IAAA,SAAAiE,SAAA,CAAAjE,IAAA,SACmC,CAAAkE,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC,CACnEC,KAAK,CAAE,IAAI,CACXC,KAAK,CAAE,CACLC,KAAK,CAAE,IAAI,CACXC,MAAM,CAAE,GACV,CACF,CAAC,CAAC,QANF7F,gBAAgB,CAACsB,OAAO,CAAAgE,SAAA,CAAAtC,IAAA,CAQxBxD,YAAY,CAACR,WAAW,CAAE,UAAM,CAC9B,GAAM,CAAA8G,iBAAiB,CAAG7F,iBAAiB,CAACqB,OAAO,CAACtC,WAAW,CAAC,CAEhE,GAAI8G,iBAAiB,CAAE,CACrBA,iBAAiB,CAACC,MAAM,CAAG,CAAC,CAC5BD,iBAAiB,CAACvD,SAAS,CAAGvC,gBAAgB,CAACsB,OAAO,CACxD,CACF,CAAC,CAAC,CAAC,wBAAAgE,SAAA,CAAAlC,IAAA,MAAAgC,QAAA,GACJ,UAAAD,aAAA,CAAA7E,KAAA,MAAAC,SAAA,GAED2E,YAAY,CAAC,CAAC,CACXc,IAAI,CAAC,iBAAM,CAAAlH,MAAM,CAACiD,IAAI,CAAChD,OAAO,CAACkH,IAAI,CAAE,CAACC,IAAI,CAAEhH,MAAM,CAAC,CAAC,GAAC,CACrDiH,KAAK,CAAC,SAAAC,CAAC,QAAI,CAAA5E,OAAO,CAAC6E,KAAK,CAAC,0BAA0B,CAAED,CAAC,CAAC,GAAC,CAE3D,CAAC;AACL;AACA;AACA;AACA,QAJK,CAKH,CAAC,CAAE,CAAClH,MAAM,CAAC,CAAC,CAEZ,GAAM,CAAAoH,eAAe,CAAG3H,WAAW,CAAC,SAAC4H,EAAE,CAAEC,IAAI,CAAK,CAChDvG,iBAAiB,CAACqB,OAAO,CAACiF,EAAE,CAAC,CAAGC,IAAI,CACtC,CAAC,CAAE,EAAE,CAAC,CAEN,MAAO,CACLlH,OAAO,CAAPA,OAAO,CACPgH,eAAe,CAAfA,eACF,CAAC,CACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}